# Migration `20200910080804`

This migration has been generated by adward at 9/10/2020, 3:08:04 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `test`.`User` (
`id` int  NOT NULL  AUTO_INCREMENT,
`name` varchar(191)  ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `test`.`Permission` (
`action` varchar(191)  NOT NULL ,
`can` ENUM('write', 'read', 'delete', 'all')  NOT NULL DEFAULT 'all',
`parent` varchar(191)  ,
PRIMARY KEY (`action`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `test`.`UserPermission` (
`id` int  NOT NULL  AUTO_INCREMENT,
`userId` int  NOT NULL ,
`permissionId` varchar(191)  NOT NULL ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `test`.`Role` (
`name` varchar(191)  NOT NULL ,
PRIMARY KEY (`name`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `test`.`RolePermission` (
`id` int  NOT NULL  AUTO_INCREMENT,
`permissionId` varchar(191)  NOT NULL ,
`roleName` varchar(191)  ,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `test`.`Permission` ADD FOREIGN KEY (`parent`) REFERENCES `test`.`Permission`(`action`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `test`.`UserPermission` ADD FOREIGN KEY (`userId`) REFERENCES `test`.`User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `test`.`UserPermission` ADD FOREIGN KEY (`permissionId`) REFERENCES `test`.`Permission`(`action`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `test`.`RolePermission` ADD FOREIGN KEY (`permissionId`) REFERENCES `test`.`Permission`(`action`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `test`.`RolePermission` ADD FOREIGN KEY (`roleName`) REFERENCES `test`.`Role`(`name`) ON DELETE SET NULL ON UPDATE CASCADE

DROP TABLE `test`.`_migration`
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200910080804
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,53 @@
+generator client {
+    provider = "prisma-client-js"
+    output   = "./src/generated/client"
+}
+
+datasource db {
+    provider = "mysql"
+    url = "***"
+}
+
+model User {
+    id             Int              @default(autoincrement()) @id
+    name           String?
+    userPermission UserPermission[]
+}
+
+model Permission {
+    action         String           @id
+    can            CanType          @default(all)
+    parent         String?
+    permission     Permission?      @relation("PermissionToPermission", fields: [parent], references: [action])
+    subPermission  Permission[]     @relation("PermissionToPermission")
+    UserPermission UserPermission[]
+    RolePermission RolePermission[]
+}
+
+model UserPermission {
+    id           Int        @default(autoincrement()) @id
+    userId       Int
+    user         User       @relation(fields: [userId], references: [id])
+    permissionId String
+    permission   Permission @relation(fields: [permissionId], references: [action])
+}
+
+model Role {
+    name           String           @id
+    rolePermission RolePermission[]
+}
+
+model RolePermission {
+    id           Int        @default(autoincrement()) @id
+    permissionId String
+    permission   Permission @relation(fields: [permissionId], references: [action])
+    Role         Role?      @relation(fields: [roleName], references: [name])
+    roleName     String?
+}
+
+enum CanType {
+    write
+    read
+    delete
+    all
+}
```


